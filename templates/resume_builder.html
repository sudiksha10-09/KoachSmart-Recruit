{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">

            <!-- Header -->
            <div class="glass-card p-4 mb-4 text-center">
                <h2 class="fw-bold mb-2">AI Resume Builder</h2>
                <p class="text-muted opacity-75 small">
                    Generate your resume by speaking ‚Äî no typing required.
                </p>

                <div class="alert alert-info py-2 mb-3 small d-inline-block">
                    üéôÔ∏è Speak your experience in Hindi or English. Edit before download.
                </div>

                <!-- Voice Controls -->
                <div class="d-flex justify-content-center gap-2 flex-wrap mb-3">
                    <select id="voiceLang" class="form-select form-select-sm w-auto">
                        <option value="en-IN">English</option>
                        <option value="hi-IN">Hindi</option>
                    </select>

                    <button id="startVoice" class="btn btn-outline-primary btn-sm">
                        üéôÔ∏è Speak Resume
                    </button>

                    <span id="voiceStatus" class="small text-muted align-self-center"></span>
                </div>

                <button onclick="window.print()" class="btn btn-primary">
                    <i class="fas fa-download me-2"></i>Download PDF
                </button>
            </div>

            <!-- RESUME SHEET -->
            <div class="p-5 rounded shadow-lg"
                 id="printableResume"
                 style="background-color:#fff;color:#212529;">

                <!-- Header Row -->
                <div class="d-flex justify-content-between border-bottom pb-4 mb-4">
                    <div>
                        <h1 class="fw-bold display-5 mb-1" contenteditable="true">
                            {{ profile.full_name }}
                        </h1>
                        <h5 class="fw-bold text-primary" contenteditable="true">
                            {{ profile.sport }} Coach | {{ profile.experience_years }} Years Experience
                        </h5>
                    </div>
                    <div class="text-end">
                        <p class="fw-bold mb-0" contenteditable="true">{{ profile.user.email }}</p>
                        <p class="fw-bold mb-0" contenteditable="true">{{ profile.phone }}</p>
                        {% if profile.is_verified %}
                        <span class="badge bg-success mt-2">Verified Professional</span>
                        {% endif %}
                    </div>
                </div>

                <!-- Professional Summary -->
                <div class="mb-5">
                    <h4 class="fw-bold text-uppercase border-bottom pb-2 mb-3">
                        Professional Summary
                    </h4>
                    <p class="lead"
                       id="summaryField"
                       contenteditable="true"
                       style="line-height:1.6;">
                        {{ ai_summary }}
                    </p>
                </div>

                <!-- Core Competencies -->
                <div class="mb-5">
                    <h4 class="fw-bold text-uppercase border-bottom pb-2 mb-3">
                        Core Competencies
                    </h4>
                    <div class="d-flex flex-wrap gap-2" contenteditable="true">
                        {% if profile.certifications %}
                            {% for cert in profile.certifications.split(',') %}
                                <span class="badge bg-dark px-3 py-2">{{ cert.strip() }}</span>
                            {% endfor %}
                        {% endif %}
                        <span class="badge bg-primary px-3 py-2">Athlete Development</span>
                        <span class="badge bg-primary px-3 py-2">Team Strategy</span>
                        <span class="badge bg-primary px-3 py-2">Performance Analysis</span>
                    </div>
                </div>

                <!-- Experience -->
                <div class="mb-5">
                    <h4 class="fw-bold text-uppercase border-bottom pb-2 mb-3">
                        Experience Highlights
                    </h4>
                    <ul class="list-unstyled">
                        <li>
                            <h5 class="fw-bold" contenteditable="true">
                                Professional Coaching Practice
                            </h5>
                            <p contenteditable="true">
                                Conducted structured training sessions and improved athlete performance through focused coaching.
                            </p>
                        </li>
                    </ul>
                </div>

                <div class="text-center pt-4 border-top">
                    <small class="text-muted">Generated by KOACHSMART</small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
[contenteditable="true"]:hover {
    background: rgba(255, 255, 0, 0.12);
    outline: 1px dashed #ccc;
    cursor: text;
}

@media print {
    body * { visibility: hidden; }
    #printableResume, #printableResume * { visibility: visible; }
    #printableResume {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        box-shadow: none;
    }
    .glass-card, .navbar, footer { display: none; }
}
</style>

<script>
let recognition;

document.getElementById("startVoice").addEventListener("click", () => {
    const lang = document.getElementById("voiceLang").value;
    const status = document.getElementById("voiceStatus");

    if (!("webkitSpeechRecognition" in window || "SpeechRecognition" in window)) {
        alert("Voice input works best on Chrome or Edge.");
        return;
    }

    recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = lang;
    recognition.interimResults = false;
    recognition.continuous = false;

    status.innerText = "üéôÔ∏è Listening...";

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("summaryField").innerText = transcript;
        status.innerText = "‚úÖ Voice added. You can edit it.";
    };

    recognition.onerror = () => {
        status.innerText = "‚ùå Voice error. Try again.";
    };

    recognition.start();
});
</script>

{% endblock %}
